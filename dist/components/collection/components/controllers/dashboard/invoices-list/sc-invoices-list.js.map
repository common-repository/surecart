{"version":3,"file":"sc-invoices-list.js","sourceRoot":"","sources":["../../../../../src/components/controllers/dashboard/invoices-list/sc-invoices-list.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, Fragment, h, Prop, State } from '@stencil/core';\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport { addQueryArgs } from '@wordpress/url';\n\nimport apiFetch from '../../../../functions/fetch';\nimport { onFirstVisible } from '../../../../functions/lazy';\nimport { Checkout, Invoice, Order } from '../../../../types';\n\n@Component({\n  tag: 'sc-invoices-list',\n  styleUrl: 'sc-invoices-list.scss',\n  shadow: true,\n})\nexport class ScInvoicesList {\n  @Element() el: HTMLScInvoicesListElement;\n  /** Query to fetch invoices */\n  @Prop({ mutable: true }) query: {\n    page: number;\n    per_page: number;\n  } = {\n    page: 1,\n    per_page: 10,\n  };\n  @Prop() allLink: string;\n  @Prop() heading: string;\n  @Prop() isCustomer: boolean;\n\n  @State() invoices: Array<Invoice> = [];\n\n  /** Loading state */\n  @State() loading: boolean;\n  @State() busy: boolean;\n\n  /** Error message */\n  @State() error: string;\n\n  @State() pagination: {\n    total: number;\n    total_pages: number;\n  } = {\n    total: 0,\n    total_pages: 0,\n  };\n\n  /** Only fetch if visible */\n  componentWillLoad() {\n    onFirstVisible(this.el, () => {\n      this.initialFetch();\n    });\n  }\n\n  async initialFetch() {\n    try {\n      this.loading = true;\n      await this.getInvoices();\n    } catch (e) {\n      console.error(this.error);\n      this.error = e?.message || __('Something went wrong', 'surecart');\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async fetchInvoices() {\n    try {\n      this.busy = true;\n      await this.getInvoices();\n    } catch (e) {\n      console.error(this.error);\n      this.error = e?.message || __('Something went wrong', 'surecart');\n    } finally {\n      this.busy = false;\n    }\n  }\n\n  /** Get all invoices */\n  async getInvoices() {\n    if (!this.isCustomer) {\n      return;\n    }\n    const response = (await await apiFetch({\n      path: addQueryArgs(`surecart/v1/invoices/`, {\n        expand: ['checkout'],\n        ...this.query,\n      }),\n      parse: false,\n    })) as Response;\n    this.pagination = {\n      total: parseInt(response.headers.get('X-WP-Total')),\n      total_pages: parseInt(response.headers.get('X-WP-TotalPages')),\n    };\n    this.invoices = (await response.json()) as Invoice[];\n    return this.invoices;\n  }\n\n  nextPage() {\n    this.query.page = this.query.page + 1;\n    this.fetchInvoices();\n  }\n\n  prevPage() {\n    this.query.page = this.query.page - 1;\n    this.fetchInvoices();\n  }\n\n  renderLoading() {\n    return (\n      <sc-card noPadding>\n        <sc-stacked-list>\n          <sc-stacked-list-row style={{ '--columns': '4' }} mobile-size={500}>\n            {[...Array(4)].map(() => (\n              <sc-skeleton style={{ width: '100px', display: 'inline-block' }}></sc-skeleton>\n            ))}\n          </sc-stacked-list-row>\n        </sc-stacked-list>\n      </sc-card>\n    );\n  }\n\n  renderEmpty() {\n    return (\n      <div>\n        <sc-divider style={{ '--spacing': '0' }}></sc-divider>\n        <slot name=\"empty\">\n          <sc-empty icon=\"shopping-bag\">{__(\"You don't have any invoices.\", 'surecart')}</sc-empty>\n        </slot>\n      </div>\n    );\n  }\n\n  getInvoiceRedirectUrl(invoice: Invoice) {\n    // if it's open, redirect to checkout for payment.\n    if (invoice.status === 'open') {\n      return `${window.scData.pages.checkout}?checkout_id=${(invoice?.checkout as Checkout)?.id}`;\n    }\n\n    // else it's paid(as we're fetching only open/paid), redirect to order detail page.\n    return addQueryArgs(window.location.href, {\n      action: 'show',\n      model: 'order',\n      id: ((invoice?.checkout as Checkout)?.order as Order)?.id,\n    });\n  }\n\n  renderList() {\n    return this.invoices.map(invoice => {\n      const { checkout } = invoice;\n      if (!checkout) return null;\n      const { amount_due, currency } = checkout as Checkout;\n      return (\n        <sc-stacked-list-row href={this.getInvoiceRedirectUrl(invoice)} style={{ '--columns': '4' }} mobile-size={500}>\n          <div>#{invoice?.order_number}</div>\n          <div>\n            {invoice?.due_date ? (\n              <Fragment>\n                {__('Due on', 'surecart')} <sc-format-date class=\"invoice__date\" date={invoice?.due_date * 1000} month=\"short\" day=\"numeric\" year=\"numeric\"></sc-format-date>\n              </Fragment>\n            ) : (\n              'â€”'\n            )}\n          </div>\n          <div class=\"invoices-list__status\">\n            <sc-invoice-status-badge status={invoice?.status}></sc-invoice-status-badge>\n          </div>\n          <div>\n            <sc-format-number type=\"currency\" currency={currency} value={amount_due}></sc-format-number>\n          </div>\n        </sc-stacked-list-row>\n      );\n    });\n  }\n\n  renderContent() {\n    if (this.loading) {\n      return this.renderLoading();\n    }\n\n    if (this.invoices?.length === 0) {\n      return this.renderEmpty();\n    }\n\n    return (\n      <sc-card no-padding>\n        <sc-stacked-list>{this.renderList()}</sc-stacked-list>\n      </sc-card>\n    );\n  }\n\n  render() {\n    return (\n      <sc-dashboard-module class=\"invoices-list\" error={this.error}>\n        <span slot=\"heading\">\n          <slot name=\"heading\">{this.heading || __('Invoices', 'surecart')}</slot>\n        </span>\n\n        {!!this.allLink && !!this.invoices?.length && (\n          <sc-button type=\"link\" href={this.allLink} slot=\"end\" aria-label={sprintf(__('View all %s', 'surecart'), this.heading || __('Invoices', 'surecart'))}>\n            {__('View all', 'surecart')}\n            <sc-icon aria-hidden=\"true\" name=\"chevron-right\" slot=\"suffix\"></sc-icon>\n          </sc-button>\n        )}\n\n        {this.renderContent()}\n\n        {!this.allLink && (\n          <sc-pagination\n            page={this.query.page}\n            perPage={this.query.per_page}\n            total={this.pagination.total}\n            totalPages={this.pagination.total_pages}\n            totalShowing={this?.invoices?.length}\n            onScNextPage={() => this.nextPage()}\n            onScPrevPage={() => this.prevPage()}\n          ></sc-pagination>\n        )}\n\n        {this.busy && <sc-block-ui></sc-block-ui>}\n      </sc-dashboard-module>\n    );\n  }\n}\n"]}