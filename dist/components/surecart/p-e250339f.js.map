{"version":3,"names":["removeQueryArgs","url","queryStringIndex","indexOf","query","getQueryArgs","baseURL","substr","_len","arguments","length","args","Array","_key","forEach","arg","queryString","buildQueryString","safeRead","storage","key","JSON","parse","getItem","debounce","fn","called","setTimeout","createStorageStore","defaultValues","syncAcrossTabs","store","createStore","_a","newValue","oldValue","stringify","write","setItem","state","window","addEventListener","currentState","set","use","reset","createLocalStore","localStorage","checkout","getSerializedState","notPersistCart","persist","getQueryArg","location","href","live","test","onChange","on","get","dispose","scStore","formId","groupId","mode","locks","product","currencyCode","abandonedCheckoutEnabled","initialLineItems","isCheckoutPage","validateStock","paymentMethodRequiresShipping","service","interpret","checkoutMachine","subscribe","stateService","formState","start","value","text","loading","undefined","speak","send","updateFormState","action","val","setCheckout","state$1","onChangeFormState","wp","i18n","__","sprintf","_p","_o","discount","promotion","code","getHumanDiscount","_q","coupon","amountDue","totalAmount","newState","_","Object","keys","handleCheckoutLineItemChange","oldCheckout","newLineItems","line_items","data","oldLineItems","_b","newItem","oldItem","find","item","id","quantity","event","CustomEvent","detail","bubbles","document","dispatchEvent","checkoutState","currentCart","previousCart","onUIChange","open","status","includes","deprecated","trialLineItems","filter","price","trial_duration_days","subscriptionLineItems","recurring_interval_count","selected_shipping_choice","currentCheckout","previousCheckout","e","trackEvent","currency","maybeConvertAmount","_c","amount","_d","items","item_id","_f","_e","item_name","_h","_g","name","item_variant","variant_options","join","_j","_k","_l","discount_amount","_m","total_amount","map","transaction_id","toUpperCase","selectedShippingChoice","shipping_choices","method","selectedShippingTier","shipping_method","shipping_tier","fbq","productCollections","product_collections","collection","content_category","content_ids","content_name","content_type","contents","num_items","getCheckout","live_mode","history","replaceState","title","addQueryArgs","checkout_id","clearCheckout","remove","checkouts","resetCheckoutState"],"sources":["../../node_modules/@wordpress/url/build-module/remove-query-args.js","./src/store/local/storage.ts","./src/store/checkouts/store.ts","./src/store/checkout/store.ts","./src/store/form/watchers.ts","./src/store/form/mutations.ts","./src/store/checkout/watchers.ts","./src/store/ui.ts","./src/store/checkouts/events.ts","./src/store/checkout/events.ts","./src/store/checkout/google.ts","./src/store/checkout/facebook.ts","./src/store/checkouts/mutations.ts"],"sourcesContent":["/**\n * Internal dependencies\n */\nimport { getQueryArgs } from './get-query-args';\nimport { buildQueryString } from './build-query-string';\n/**\n * Removes arguments from the query string of the url\n *\n * @param {string}    url  URL.\n * @param {...string} args Query Args.\n *\n * @example\n * ```js\n * const newUrl = removeQueryArgs( 'https://wordpress.org?foo=bar&bar=baz&baz=foobar', 'foo', 'bar' ); // https://wordpress.org?baz=foobar\n * ```\n *\n * @return {string} Updated URL.\n */\n\nexport function removeQueryArgs(url) {\n  const queryStringIndex = url.indexOf('?');\n\n  if (queryStringIndex === -1) {\n    return url;\n  }\n\n  const query = getQueryArgs(url);\n  const baseURL = url.substr(0, queryStringIndex);\n\n  for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    args[_key - 1] = arguments[_key];\n  }\n\n  args.forEach(arg => delete query[arg]);\n  const queryString = buildQueryString(query);\n  return queryString ? baseURL + '?' + queryString : baseURL;\n}\n//# sourceMappingURL=remove-query-args.js.map","import { createStore } from '@stencil/store';\nimport { MinimumStorage } from './types';\n\nconst safeRead = <T extends object>(storage: MinimumStorage, key: string): T | null => {\n  try {\n    return JSON.parse(storage.getItem(key));\n  } catch {\n    return null;\n  }\n};\n\nconst debounce = fn => {\n  let called = false;\n  return () => {\n    if (called) {\n      return;\n    }\n    called = true;\n    setTimeout(() => {\n      fn();\n      called = false;\n    }, 0);\n  };\n};\n\nexport const createStorageStore = <T extends object>(storage: MinimumStorage, key: string, defaultValues: T, syncAcrossTabs = false) => {\n  const store = createStore(safeRead<T>(storage, key) ?? defaultValues, (newValue, oldValue) => {\n    return JSON.stringify(newValue) !== JSON.stringify(oldValue);\n  });\n\n  // Need to sync later or we would get ourselves in an infinite loop.\n  const write = debounce(() => storage.setItem(key, JSON.stringify(store.state)));\n  write();\n\n  if (syncAcrossTabs) {\n    window.addEventListener('storage', () => {\n      const currentState = safeRead<T>(storage, key);\n\n      if (currentState === null) {\n        return;\n      }\n\n      for (const key in currentState) {\n        store.set(key, currentState[key]);\n      }\n    });\n  }\n\n  store.use({ set: write, reset: write });\n\n  return store;\n};\n\nexport const createLocalStore = <T extends object>(key: string, defaultValues: T, syncAcrossTabs = false) => createStorageStore(localStorage, key, defaultValues, syncAcrossTabs);\nexport const createSessionStore = <T extends object>(key: string, defaultValues: T) => createStorageStore(sessionStorage, key, defaultValues);\n","import { createLocalStore } from '../local';\nimport { createStore } from '@stencil/store';\nimport { getSerializedState } from '@store/utils';\nimport { getQueryArg } from '@wordpress/url';\nconst { checkout } = getSerializedState();\n\nconst notPersistCart = checkout?.persist !== 'browser' || !!getQueryArg(window.location.href, 'no_cart');\n\nconst store = notPersistCart\n  ? createStore<{ live: any; test: any }>({\n      live: {},\n      test: {},\n    })\n  : createLocalStore<{ live: any; test: any }>(\n      'surecart-local-storage',\n      {\n        live: {},\n        test: {},\n      },\n      true,\n    );\n\nconst { state, onChange, on, set, get, dispose } = store;\nwindow.scStore = store;\nexport default store;\nexport { state, onChange, on, set, get, dispose };\n","import { createStore } from '@stencil/store';\n\nimport { Checkout, LineItemData, Product, TaxProtocol } from '../../types';\nimport { getSerializedState } from '@store/utils';\nconst { checkout } = getSerializedState();\n\ninterface Store {\n  formId: number | string;\n  groupId: string;\n  mode: 'live' | 'test';\n  locks: string[];\n  product: Product;\n  checkout: Checkout;\n  currencyCode: string;\n  abandonedCheckoutEnabled: boolean;\n  initialLineItems: LineItemData[];\n  taxProtocol: TaxProtocol;\n  isCheckoutPage: boolean;\n  validateStock: boolean;\n  persist: 'browser' | 'url' | false;\n  paymentMethodRequiresShipping: boolean;\n}\n\nconst { state, onChange, on, set, get, dispose, reset } = createStore<Store>(\n  {\n    formId: null,\n    groupId: null,\n    mode: 'live',\n    locks: [],\n    product: null,\n    checkout: null,\n    currencyCode: 'usd',\n    abandonedCheckoutEnabled: true,\n    initialLineItems: [],\n    isCheckoutPage: false,\n    validateStock: false,\n    persist: 'browser',\n    paymentMethodRequiresShipping: false,\n    ...checkout,\n  },\n  (newValue, oldValue) => {\n    return JSON.stringify(newValue) !== JSON.stringify(oldValue);\n  },\n);\n\nexport default state;\nexport { state, onChange, on, set, get, dispose, reset };\n","import { checkoutMachine } from '../../../src/components/providers/form-state-provider/checkout-machine';\nimport { interpret } from '@xstate/fsm';\nimport { speak } from '@wordpress/a11y';\nimport state, { onChange } from './store';\n\n// Start state machine.\nconst service = interpret(checkoutMachine);\nservice.subscribe(stateService => (state.formState = stateService));\nservice.start();\n\n// on change formState, speak the current state.\nonChange('formState', () => {\n  const { formState } = state;\n  const { value } = formState;\n  if (state.text.loading[value] === undefined) return;\n\n  speak(state.text.loading[value], 'assertive');\n});\n\nexport default service;\n","import service from './watchers';\nconst { send } = service;\nexport const updateFormState = action => send(action);\n","import state, { onChange, on } from './store';\nimport { getCheckout, setCheckout } from '../checkouts/mutations';\nimport { onChange as onChangeFormState } from '../form';\nimport { updateFormState } from '../form/mutations';\nimport { Checkout, Invoice } from '../../types';\nimport { speak } from '@wordpress/a11y';\nimport { __, sprintf } from '@wordpress/i18n';\nimport { getFormattedPrice, getHumanDiscount } from '../../functions/price';\n\n/**\n * When the checkout changes, update the\n * checkout in localstorage.\n */\nonChange('checkout', val => setCheckout(val, state.formId));\n\n/**\n * When the checkout changes, update the mode to match the checkout.\n */\nonChange('checkout', val => {\n  if (val?.id) {\n    state.mode = !val?.live_mode ? 'test' : 'live';\n  }\n});\n\n// When the form state changes, update the form state based on the invoice status.\nonChangeFormState('formState', ({ value }) => {\n  if (value !== 'draft') return;\n\n  // if there is an invoice and it is not open, lock the form.\n  if ((state.checkout?.invoice as Invoice)?.status && (state.checkout?.invoice as Invoice)?.status !== 'open') {\n    updateFormState('LOCK');\n  }\n});\n\n/**\n * When checkout is get, get the checkout from the checkouts state.\n */\non('get', prop => {\n  if (prop === 'checkout') {\n    const checkout = getCheckout(state.formId, state.mode);\n    if (checkout?.id) {\n      state.checkout = checkout;\n    }\n  }\n});\n\non('set', (key: string, checkout: Checkout, oldCheckout: Checkout) => {\n  if (key !== 'checkout') return; // we only care about checkout\n  if (!oldCheckout || !checkout) return; // checkout was not updated.\n  if (checkout?.total_amount === oldCheckout?.total_amount && checkout?.amount_due === oldCheckout?.total_amount) return; // we only care about total_amount and amount_due\n\n  const amountDue = getFormattedPrice({\n    amount: checkout.amount_due,\n    currency: checkout.currency,\n  });\n  const totalAmount = getFormattedPrice({\n    amount: checkout.total_amount,\n    currency: checkout.currency,\n  });\n\n  const couponCodeAdded = checkout?.discount?.promotion?.code !== oldCheckout?.discount?.promotion?.code && checkout?.discount?.promotion?.code;\n  const couponCodeRemoved = checkout?.discount?.promotion?.code !== oldCheckout?.discount?.promotion?.code && !checkout?.discount?.promotion?.code;\n\n  const messages = [\n    ...(couponCodeRemoved ? [__('Coupon code removed.', 'sc-coupon-form')] : []),\n    ...(couponCodeAdded\n      ? [\n          sprintf(\n            // Translators: %1$s is the coupon code, %2$s is the human readable discount.\n            __('Coupon code %1$s added. %2$s applied.', 'sc-coupon-form'),\n            checkout?.discount?.promotion?.code,\n            getHumanDiscount(checkout?.discount?.coupon),\n          ),\n        ]\n      : []),\n    checkout.total_amount === checkout.amount_due\n      ? sprintf(__('Checkout updated. The amount due is %1$s.', 'surecart'), amountDue)\n      : sprintf(__('Checkout updated. The total amount for the checkout is %1$s and the amount due is %1$s.', 'surecart'), totalAmount, amountDue),\n  ];\n\n  speak(messages.join(' '));\n});\n","import { createStore } from '@stencil/store';\nimport { speak } from '@wordpress/a11y';\nimport { __ } from '@wordpress/i18n';\n\nexport const store = createStore<any>(\n  () => ({\n    cart: {\n      open: false,\n    },\n  }),\n  (newValue, oldValue) => {\n    return JSON.stringify(newValue) !== JSON.stringify(oldValue);\n  },\n);\n\nconst { state } = store;\n\nexport const toggleCart = (open = null) => store.set('cart', { ...state.cart, ...{ open: open !== null ? open : !state.cart.open } });\n\nconst { on } = store;\non('set', (key, newState) => {\n  if (key !== 'cart') return; // we only care about cart.\n\n  if (newState?.open) {\n    speak(__('Cart Opened', 'surecart'), 'assertive');\n  } else {\n    speak(__('Cart Closed', 'surecart'), 'assertive');\n  }\n});\n\nexport { on };\nexport default store;\n","import { on } from './store';\nimport { on as onUIChange } from '@store/ui';\nimport { state as checkoutState } from '@store/checkout';\nimport { Checkout, LineItem } from 'src/types';\n\n// Listen to all stored checkouts and handle line item changes.\non('set', (_, value, oldValue) => Object.keys(value || {}).forEach(key => handleCheckoutLineItemChange(value[key] as Checkout, oldValue?.[key])));\n\n/**\n * Add to cart/remove from cart, cart updated events.\n */\nexport const handleCheckoutLineItemChange = (checkout: Checkout, oldCheckout: Checkout) => {\n  // get new and old line items.\n  const newLineItems = (checkout as Checkout)?.line_items?.data || [];\n  const oldLineItems = (oldCheckout as Checkout)?.line_items?.data || [];\n\n  // check for added items or quantity changed\n  newLineItems.forEach(newItem => {\n    const oldItem = oldLineItems.find(item => item.id === newItem.id);\n    // an item was added, or the quantity changed.\n    if (!oldItem || oldItem?.quantity < newItem?.quantity) {\n      const event = new CustomEvent<LineItem>('scAddedToCart', {\n        detail: {\n          ...newItem,\n          quantity: newItem.quantity - (oldItem?.quantity || 0),\n        },\n        bubbles: true,\n      });\n      document.dispatchEvent(event);\n    }\n  });\n\n  // check for removed items or quantity changed\n  oldLineItems.forEach(oldItem => {\n    const newItem = newLineItems.find(item => item.id === oldItem.id);\n    // an item was removed, or the quantity changed.\n    if (!newItem || oldItem?.quantity > newItem?.quantity) {\n      const event = new CustomEvent<LineItem>('scRemovedFromCart', {\n        detail: {\n          ...oldItem,\n          quantity: oldItem.quantity - (newItem?.quantity || 0),\n        },\n        bubbles: true,\n      });\n      document.dispatchEvent(event);\n    }\n  });\n\n  // check if line items have changed.\n  if (!checkoutState?.isCheckoutPage && JSON.stringify(newLineItems) !== JSON.stringify(oldLineItems)) {\n    // emit an event here with the checkout state updates.\n    const event = new CustomEvent<{ currentCart: Checkout; previousCart: Checkout }>('scCartUpdated', {\n      detail: {\n        currentCart: checkout,\n        previousCart: oldCheckout,\n      },\n      bubbles: true,\n    });\n    document.dispatchEvent(event);\n  }\n};\n\n/**\n * Handle view cart event.\n */\nonUIChange('set', (key: string, newValue: { open: boolean }, oldValue: { open: boolean }) => {\n  if (key !== 'cart') return; // we only care about cart.\n  if (newValue?.open === oldValue?.open) return; // we only care about open state changes.\n\n  if (newValue?.open) {\n    const event = new CustomEvent('scViewedCart', {\n      detail: checkoutState.checkout,\n      bubbles: true,\n    });\n    document.dispatchEvent(event);\n  }\n});\n","import '../checkouts/events';\nimport state, { on } from './store';\nimport { Checkout, LineItem } from 'src/types';\n\n/**\n * Checkout initiated event.\n */\non('set', (key, checkout: Checkout, oldCheckout: Checkout) => {\n  if (key !== 'checkout') return; // we only care about checkout\n  if (oldCheckout?.id) return; // we only care about new checkouts.\n  if (!checkout?.id) return; // we don't have a saved checkout.\n  if (!state.isCheckoutPage) return; // we don't want to fire this if we are not on the checkout page.\n\n  const event = new CustomEvent<Checkout>('scCheckoutInitiated', {\n    detail: checkout,\n    bubbles: true,\n  });\n\n  document.dispatchEvent(event);\n});\n\n/**\n * Purchase complete, trial start event.\n */\non('set', (key, checkout: Checkout, oldCheckout: Checkout) => {\n  if (key !== 'checkout') return; // we only care about checkout\n  if (!checkout?.status || oldCheckout?.status === checkout?.status) return; // we only care about status changes.\n  if (!['paid', 'processing'].includes(checkout.status)) return; // only if it's paid or processing.\n\n  // order paid is deprecated.\n  const deprecated = new CustomEvent('scOrderPaid', { detail: checkout, bubbles: true });\n  document.dispatchEvent(deprecated);\n\n  // emit the new event.\n  const event = new CustomEvent('scCheckoutCompleted', { detail: checkout, bubbles: true });\n  document.dispatchEvent(event);\n\n  // get trial line items and emit trial event if there are any.\n  const trialLineItems: LineItem[] = (checkout?.line_items?.data || []).filter(item => item?.price?.trial_duration_days > 0);\n  if (trialLineItems.length > 0) {\n    const event = new CustomEvent('scTrialStarted', { detail: trialLineItems, bubbles: true });\n    document.dispatchEvent(event);\n  }\n\n  // get subscription line items and emit subscription event if there are any.\n  const subscriptionLineItems: LineItem[] = (checkout?.line_items?.data || []).filter(item => item?.price?.recurring_interval_count > 0);\n  if (subscriptionLineItems.length > 0) {\n    const event = new CustomEvent('scSubscriptionStarted', { detail: subscriptionLineItems, bubbles: true });\n    document.dispatchEvent(event);\n  }\n});\n\n/**\n * Shipping info added event.\n */\non('set', (key, checkout: Checkout, oldCheckout: Checkout) => {\n  if (key !== 'checkout') return; // we only care about checkout\n  if (!state.isCheckoutPage) return; // we don't want to fire this if we are not on the checkout page.\n  if (!checkout?.selected_shipping_choice) return; // we only care about shipping info.\n  if (oldCheckout?.selected_shipping_choice === checkout?.selected_shipping_choice) return; // we only care about new shipping info.\n\n  const event = new CustomEvent<Checkout>('scShippingInfoAdded', {\n    detail: checkout,\n    bubbles: true,\n  });\n  document.dispatchEvent(event);\n});\n\n/**\n * Checkout updated event.\n */\non('set', (key: string, checkout: Checkout, oldCheckout: Checkout) => {\n  if (key !== 'checkout') return; // we only care about checkout\n  if (!state.isCheckoutPage) return; // we don't want to fire this if we are not on the checkout page.\n  if (!oldCheckout?.id) return; // we don't have a saved checkout.\n  if (JSON.stringify(checkout) === JSON.stringify(oldCheckout)) return; // we only care about changes.\n\n  const event = new CustomEvent('scCheckoutUpdated', {\n    detail: {\n      currentCheckout: checkout,\n      previousCheckout: oldCheckout,\n    },\n    bubbles: true,\n  });\n  document.dispatchEvent(event);\n});\n","import { trackEvent } from '../../functions/google';\nimport { maybeConvertAmount } from '../../functions/currency';\nimport { Checkout, LineItem, Product, ShippingMethod } from 'src/types';\n\n/**\n * Handle add to cart event.\n */\nwindow.addEventListener('scAddedToCart', (e: CustomEvent) => {\n  const item: LineItem = e.detail;\n\n  // sanity check.\n  if (!item?.price?.product) return;\n\n  trackEvent('add_to_cart', {\n    currency: item.price?.currency,\n    value: maybeConvertAmount(item?.price?.amount || 0, item.price?.currency || 'USD'),\n    items: [\n      {\n        item_id: (item.price?.product as Product)?.id,\n        item_name: (item.price?.product as Product)?.name,\n        item_variant: (item.variant_options || []).join(' / '),\n        price: maybeConvertAmount(item?.price?.amount || 0, item.price?.currency || 'USD'),\n        currency: item.price?.currency,\n        quantity: item.quantity,\n        discount: item?.discount_amount ? maybeConvertAmount(item?.discount_amount || 0, item.price?.currency || 'USD') : 0,\n      },\n    ],\n  });\n});\n\n/**\n * Handle remove from cart event.\n */\nwindow.addEventListener('scRemovedFromCart', (e: CustomEvent) => {\n  const item: LineItem = e.detail;\n\n  // sanity check.\n  if (!item?.price?.product) return;\n\n  trackEvent('remove_from_cart', {\n    currency: item.price?.currency,\n    value: maybeConvertAmount(item?.price?.amount || 0, item.price?.currency || 'USD'),\n    items: [\n      {\n        item_id: (item.price?.product as Product)?.id,\n        item_name: (item.price?.product as Product)?.name,\n        item_variant: (item.variant_options || []).join(' / '),\n        price: maybeConvertAmount(item?.price?.amount || 0, item.price?.currency || 'USD'),\n        currency: item.price?.currency,\n        quantity: item.quantity,\n        discount: item?.discount_amount ? maybeConvertAmount(item?.discount_amount || 0, item.price?.currency || 'USD') : 0,\n      },\n    ],\n  });\n});\n\n/**\n * Handle view cart event.\n */\nwindow.addEventListener('scViewedCart', (e: CustomEvent) => {\n  const checkout: Checkout = e.detail;\n\n  trackEvent('view_cart', {\n    currency: checkout.currency,\n    value: maybeConvertAmount(checkout.total_amount, checkout.currency),\n    items: (checkout.line_items?.data || []).map(item => ({\n      item_id: (item?.price?.product as Product)?.id,\n      item_name: (item?.price?.product as Product)?.name,\n      currency: item.price?.currency,\n      discount: item.discount_amount ? maybeConvertAmount(item.discount_amount, item.price?.currency) : 0,\n      price: maybeConvertAmount(item?.price?.amount, item.price?.currency),\n      quantity: item.quantity,\n      ...(item?.variant_options?.length ? { item_variant: (item.variant_options || []).join(' / ') } : {}),\n    })),\n  });\n});\n\n/**\n * Handle checkout initiated event.\n */\nwindow.addEventListener('scCheckoutInitiated', (e: CustomEvent) => {\n  const checkout: Checkout = e.detail;\n\n  trackEvent('begin_checkout', {\n    currency: checkout.currency,\n    value: maybeConvertAmount(checkout.total_amount, checkout.currency),\n    items: (checkout.line_items?.data || []).map(item => ({\n      item_id: (item?.price?.product as Product)?.id,\n      item_name: (item?.price?.product as Product)?.name,\n      currency: item.price?.currency,\n      discount: item.discount_amount ? maybeConvertAmount(item.discount_amount, item.price?.currency) : 0,\n      price: maybeConvertAmount(item?.price?.amount, item.price?.currency),\n      quantity: item.quantity,\n      ...(item?.variant_options?.length ? { item_variant: (item.variant_options || []).join(' / ') } : {}),\n    })),\n  });\n});\n\n/**\n * Handle purchase complete event.\n */\nwindow.addEventListener('scCheckoutCompleted', (e: CustomEvent) => {\n  const checkout: Checkout = e.detail;\n\n  trackEvent('purchase', {\n    transaction_id: checkout?.id,\n    value: maybeConvertAmount(checkout?.total_amount, checkout?.currency || 'USD'),\n    currency: (checkout.currency || '').toUpperCase(),\n    items: (checkout?.line_items?.data || []).map(item => ({\n      item_id: (item?.price?.product as Product)?.id,\n      currency: (checkout.currency || '').toUpperCase(),\n      item_name: (item?.price?.product as Product)?.name || '',\n      discount: item?.discount_amount ? maybeConvertAmount(item?.discount_amount || 0, item?.price?.currency || 'USD') : 0,\n      price: maybeConvertAmount(item?.price?.amount || 0, item?.price?.currency || 'USD'),\n      quantity: item?.quantity || 1,\n      ...(item?.variant_options?.length ? { item_variant: (item.variant_options || []).join(' / ') } : {}),\n    })),\n  });\n});\n\n/**\n * Handle payment info added event.\n */\nwindow.addEventListener('scPaymentInfoAdded', (e: CustomEvent) => {\n  const checkout = e.detail;\n\n  trackEvent('add_payment_info', {\n    currency: checkout.currency,\n    value: maybeConvertAmount(checkout.total_amount, checkout.currency),\n    items: (checkout.line_items?.data || []).map(item => ({\n      item_id: (item?.price?.product as Product)?.id,\n      item_name: (item?.price?.product as Product)?.name || '',\n      currency: item.price?.currency,\n      discount: item.discount_amount ? maybeConvertAmount(item.discount_amount, item.price?.currency) : 0,\n      price: maybeConvertAmount(item?.price?.amount, item.price?.currency),\n      quantity: item.quantity,\n      ...(item?.variant_options?.length ? { item_variant: (item.variant_options || []).join(' / ') } : {}),\n    })),\n  });\n});\n\n/**\n * Handle shipping info added event.\n */\nwindow.addEventListener('scShippingInfoAdded', (e: CustomEvent) => {\n  const checkout: Checkout = e.detail;\n  const selectedShippingChoice = checkout?.shipping_choices?.data?.find(method => method.id === checkout?.selected_shipping_choice);\n  const selectedShippingTier = (selectedShippingChoice?.shipping_method as ShippingMethod)?.name || '';\n\n  trackEvent('add_shipping_info', {\n    currency: checkout.currency,\n    value: maybeConvertAmount(checkout.total_amount, checkout.currency),\n    ...(checkout?.discount?.promotion?.code ? { coupon: checkout?.discount?.promotion?.code } : {}),\n    ...(selectedShippingTier ? { shipping_tier: selectedShippingTier } : ''),\n    items: (checkout.line_items?.data || []).map(item => ({\n      item_id: (item?.price?.product as Product)?.id,\n      item_name: (item?.price?.product as Product)?.name || '',\n      currency: item.price?.currency,\n      discount: item.discount_amount ? maybeConvertAmount(item.discount_amount, item.price?.currency) : 0,\n      price: maybeConvertAmount(item?.price?.amount, item.price?.currency),\n      quantity: item.quantity,\n      ...(item?.variant_options?.length ? { item_variant: (item.variant_options || []).join(' / ') } : {}),\n    })),\n  });\n});\n","import { maybeConvertAmount } from '../../functions/currency';\nimport { Checkout, LineItem, Product } from 'src/types';\n\n/**\n * Handle add to cart event.\n */\nwindow.addEventListener('scAddedToCart', function (e: CustomEvent) {\n  if (!window?.fbq) return;\n\n  // get the added item from the event.\n  const item: LineItem = e.detail;\n\n  // sanity check.\n  if (!item?.price?.product) return;\n\n  const product = item?.price?.product as Product;\n  const productCollections: string[] = product?.product_collections?.data?.map(collection => collection.name) || [];\n\n  window.fbq('track', 'AddToCart', {\n    ...(productCollections.length ? { content_category: productCollections.join(', ') } : {}),\n    content_ids: [product.id],\n    content_name: product?.name + (item?.variant_options?.length ? ` - ${item?.variant_options.join(' / ')}` : ''),\n    content_type: 'product',\n    contents: [\n      {\n        id: product.id,\n        quantity: item.quantity,\n      },\n    ],\n    currency: item?.price?.currency,\n    value: maybeConvertAmount(item?.price?.amount || 0, item?.price?.currency || 'USD'),\n  });\n});\n\n/**\n * Handle purchase initiated event.\n */\nwindow.addEventListener('scCheckoutInitiated', function (e: CustomEvent) {\n  if (!window?.fbq) return;\n\n  const checkout: Checkout = e.detail;\n\n  window.fbq('track', 'InitiateCheckout', {\n    content_ids: (checkout?.line_items.data || [])?.map(item => item.id),\n    contents: (checkout?.line_items.data || [])?.map(item => ({ id: item.id, quantity: item.quantity })),\n    currency: checkout?.currency,\n    num_items: checkout?.line_items?.data?.length || 0,\n    value: maybeConvertAmount(checkout?.total_amount, checkout?.currency || 'USD'),\n  });\n});\n\n/**\n * Handle purchase complete event.\n */\nwindow.addEventListener('scCheckoutCompleted', function (e: CustomEvent) {\n  if (!window?.fbq) return;\n\n  const checkout = e.detail;\n\n  window.fbq('track', 'Purchase', {\n    content_ids: checkout?.items?.map(item => item.item_id),\n    content_name: 'Purchase',\n    content_type: 'product',\n    contents: checkout?.items?.map(item => ({ id: item.item_id, quantity: item.quantity })),\n    currency: checkout?.currency,\n    num_items: checkout?.items?.length,\n    value: maybeConvertAmount(checkout?.total_amount, checkout?.currency || 'USD'),\n  });\n});\n\n/**\n * Handle trial started event.\n */\nwindow.addEventListener('scTrialStarted', function (e: CustomEvent) {\n  if (!window?.fbq) return;\n\n  const items: LineItem[] = e.detail;\n\n  items.forEach(item => {\n    window.fbq('track', 'StartTrial', {\n      currency: item.price?.currency,\n      value: maybeConvertAmount(item.price?.amount || 0, item.price?.currency || 'USD'),\n    });\n  });\n});\n\n/**\n * Handle subscription started event.\n */\nwindow.addEventListener('scSubscriptionStarted', function (e: CustomEvent) {\n  if (!window?.fbq) return;\n\n  const items: LineItem[] = e.detail;\n\n  items.forEach(item => {\n    window.fbq('track', 'Subscribe', {\n      currency: item.price?.currency,\n      value: maybeConvertAmount(item.price?.amount || 0, item.price?.currency || 'USD'),\n    });\n  });\n});\n\n/**\n * Handle payment info added event.\n */\nwindow.addEventListener('scPaymentInfoAdded', function (e: CustomEvent) {\n  if (!window?.fbq) return;\n\n  const detail = e.detail;\n\n  window.fbq('track', 'AddPaymentInfo', {\n    content_category: 'Payment Info Added',\n    currency: detail?.currency,\n  });\n});\n","import { Checkout } from 'src/types';\nimport store from './store';\nimport { state as checkoutState, reset as resetCheckoutState } from '@store/checkout';\nimport { addQueryArgs, removeQueryArgs } from '@wordpress/url';\n\n/** Get the checkout. */\nexport const getCheckout = (formId: number | string, mode: 'live' | 'test') => store.state[mode]?.[formId] || {};\n\n/** Set the checkout. */\nexport const setCheckout = (data: Checkout, formId: number | string) => {\n  const mode = data?.live_mode ? 'live' : 'test';\n  store.set(mode, { ...store.state[mode], [formId]: data });\n  // update the current checkout state.\n  if (checkoutState.formId === formId && checkoutState.mode === mode) {\n    checkoutState.checkout = data;\n  }\n  // set in url only if we are not persisting the cart.\n  if (checkoutState.persist === 'url' && data?.id) {\n    window.history.replaceState({}, document.title, addQueryArgs(window.location.href, { checkout_id: data?.id }));\n  }\n};\n\n/** Clear the order from the store. */\nexport const clearCheckout = (formId: number | string, mode: 'live' | 'test') => {\n  const { [formId]: remove, ...checkouts } = store.state[mode];\n  window.history.replaceState({}, document.title, removeQueryArgs(window.location.href, 'redirect_status', 'coupon', 'line_items', 'confirm_checkout_id', 'checkout_id'));\n  store.set(mode, checkouts);\n  resetCheckoutState();\n};\n"],"mappings":"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"}